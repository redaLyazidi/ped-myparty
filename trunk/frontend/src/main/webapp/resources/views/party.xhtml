<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:af="http://xmlns.oracle.com/adf/faces/rich"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">
<h:head>

	<meta charset="utf-8" />
	<title>MyParty</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta name="description" content="" />
	<meta name="author" content="" />
	

	<!-- Le styles -->
	<h:outputStylesheet library="css" name="bootstrap.css" />
	<h:outputStylesheet library="css" name="style.css" />
	<h:outputStylesheet library="css" name="bootstrap-responsive.css" />
	
	<script>
    $(document).ready(function() {

    	$('#menuAdmin\\:editer').hover(function () {
    		$(this).tooltip({'placement' : 'bottom'});
    		$(this).tooltip('show');
    	});
    	$('#menuAdmin\\:supprimer').hover(function () {
    		$(this).tooltip({'placement' : 'bottom'});
    		$(this).tooltip('show');
    	});
    	$('#menuAdmin\\:stat').hover(function () {
    		$(this).tooltip({'placement' : 'bottom'});
    		$(this).tooltip('show');
    	});
    	$('#menuAdmin\\:billet').hover(function () {
    		$(this).tooltip({'placement' : 'bottom'});
    		$(this).tooltip('show');
    	});
    	$('#menuAdmin\\:valider').hover(function () {
    		$(this).tooltip({'placement' : 'bottom'});
    		$(this).tooltip('show');
    	});
    });
    </script>

</h:head>

<h:body>

<ui:include src="header.xhtml" />

	<div class="container">
	<h:form id="menuAdmin">
		<h:panelGroup rendered="#{loginBean.userAdmin}">
			<div id="menuAdmin" class="row-fluid" style="margin-top: 20px">
				<p:messages/>
				<div class="span10 offset1">
			    	<div class="navbar">
		    			<div class="navbar-inner">
		    				<a class="brand">Admin</a>
		    				<c:choose>
		    					<c:when test="#{partyBean.dateCourante.before(partyBean.partySelect.dateBegin)}">
				    				<ul class="nav">
				    					<li class="divider-vertical"></li>
					    				<li><h:commandButton action="#{createParty.edit(partyBean.partySelect.id)}" id="editer" image="../img/glyphicons_030_pencil.png" style="margin-left: 15px; margin-right: 15px; margin-top: 8px;" data-toggle="tooltip" title="éditer"/></li>
										<li class="divider-vertical"></li>
					    				<li><h:commandButton action="#{partyBean.deleteParty}" id="supprimer" image="../img/glyphicons_016_bin.png" style="width: 20px; height: 24px; margin-left: 15px; margin-right: 15px; margin-top: 8px;" data-toggle="tooltip" title="supprimer"/></li>
									    <li class="divider-vertical"></li>
									    <h:panelGroup rendered="#{!partyBean.hasTicket}">
										    <li><h:commandButton action="#{partyBean.createTicket}" id="billet" image="../img/glyphicons_258_qrcode.png" style="width: 24px; height: 24px; margin-left: 15px; margin-right: 15px; margin-top: 8px;" data-toggle="tooltip" title="créer billet"/></li>
										    <li class="divider-vertical"></li>
									    </h:panelGroup>
									    <h:panelGroup rendered="#{!partyBean.partySelect.validated and partyBean.hasTicket}">
										    <li><h:commandButton action="#{partyBean.validateParty}" id="valider" image="../img/glyphicons_206_ok_2.png" style="width: 28px; height: 24px; margin-left: 15px; margin-right: 15px; margin-top: 8px;" data-toggle="tooltip" title="valider party"/></li>    
									    	<li class="divider-vertical"></li>
								    	</h:panelGroup>
								    </ul>
								    <div class="pull-right" style="margin-top: 8px;">
						    			<h:outputText value="Préventes non commencées" style="font-weight: bold; color: red;"/>
						    		</div>
						    	</c:when>
						    	<c:otherwise>
						    		<ul class="nav">
						    			<li class="divider-vertical"></li>
						    			<li><h:commandButton action="statsTicket" id="stat" image="../img/glyphicons_040_stats.png" style="width: 24px; height: 24px; margin-left: 15px; margin-right: 15px; margin-top: 8px;" data-toggle="tooltip" title="historique des ventes"/></li>
						    			<li class="divider-vertical"></li>
						    		</ul>
						    		<div class="pull-right" style="margin-top: 8px;">
						    			<h:outputText value="Préventes en cours" style="font-weight: bold; color: blue;"/>
						    		</div>
						    	</c:otherwise>
						    </c:choose>
		    			</div>
		    		</div>
		    	</div>
	    	</div>
		</h:panelGroup>
	
		
			<div class="row-fluid vueParty">
				<div class="span3 offset1">
					<div class="partyImg">
						<h:graphicImage value="../upload/#{partyBean.partySelect.image}"/>
					</div>
				</div>
				
				<div class="span4" id="blocDescription">
					<div class="partyPartTitle">
						<div class="partyItemTitle">
							<h:outputText value="#{partyBean.partySelect.title}" />
						</div>
						<div class="partyItemArtist">
							<c:forEach var="artist" items="#{partyBean.partySelect.artists}">
								<h:outputText value="#{artist.name}   " />
							</c:forEach>
						</div>
						<div class="partyItemGenre">
							<h:outputText value="#{partyBean.partySelect.theme}" />
						</div>
						<div class="partyItemDate">
							<h:outputText value="#{partyBean.partySelect.dateParty.getTime()}" >
								<f:convertDateTime pattern="dd/MM/yyyy à " timeZone="Europe/Paris" />
							</h:outputText>
														
							<h:outputText value="#{partyBean.partySelect.timeParty.getTime()}">
								<f:convertDateTime pattern="HH:mm" timeZone="Europe/Paris" />
							</h:outputText>
						</div>
					</div>
					<div class="partyPartAdd">
						<div class="partyItemLieu">
							<h:outputText value="#{partyBean.partySelect.place}" />
						</div>
						<div>
							<h:outputText value="#{partyBean.partySelect.street}" />
						</div>
						<h:outputText value="#{partyBean.partySelect.CP} #{partyBean.partySelect.town}" />
					</div>
					<div class="partyPartDesc">
						<h:outputText value="#{partyBean.partySelect.description}" />
					</div>
				</div>
				<div class="span3 offset1" id="blocReservation">
					<div>
						<h:outputText value="#{partyBean.partySelect.price}">
							<f:convertNumber minFractionDigits="2" />
						</h:outputText> €
					</div>
					<div class="partyNbPlace">
						<h:outputText value="#{partyBean.partySelect.nbPlace - partyBean.partySelect.nbPlaceBought} places restantes" />
					</div>
					<div>
						Début préventes: 
						<h:outputText value="#{partyBean.partySelect.dateBegin.getTime()}">
							<f:convertDateTime pattern="dd/MM/yyyy" timeZone="Europe/Paris" />
						</h:outputText>
					</div>
					<div>
						Fin préventes: 
						<h:outputText value="#{partyBean.partySelect.dateEnd.getTime()}">
							<f:convertDateTime pattern="dd/MM/yyyy" timeZone="Europe/Paris" />
						</h:outputText>
					</div>
					<table>
						<tr>
							<td style="padding: 10px">
								<h:commandButton class="btn btn-primary" value="Réservez" ajax="false" action="#{partyBean.reserveParty}" disabled="#{partyBean.disableBuyButton}"/>
							</td>
						</tr>
					</table>
					
				</div>
			</div>
			<h:panelGroup rendered="#{loginBean.userAdmin}">
				<div class="row-fluid" style="margin-top: 150px;">
					<div class="span10 offset1">
						<div class="navbar">
							<div class="navbar-inner">
								<a class="brand">Ticket</a>
								<ul class="nav">
				    				<li class="divider-vertical"></li>
				    			</ul>
							</div>
						</div>
					</div>
					<div class="span10 offset1" style="text-align: center">
						<h:panelGroup rendered="#{partyBean.hasTicket}">
							<object type="image/svg+xml" data="#{partyBean.urlTicket}" style="max-width: 970px;"/>
						</h:panelGroup>
						<h:panelGroup rendered="#{!partyBean.hasTicket}">
							<h:outputText value="La party ne possède pas de Ticket" style="font-weight: bold; color: red;"/>
						</h:panelGroup>
						
					</div>
				</div>
			</h:panelGroup>
		</h:form>
	</div>
	
	<!-- Bootstrap -->
	<h:outputScript library="js" name="bootstrap.min.js" />

</h:body>
</html>